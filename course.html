<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./css/course.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick-theme.css">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
        integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.5.1/gsap.min.js"></script>
    <!-- <script src="./js/course/course.js"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script> -->
    <title>課程總覽</title>
</head>

<body>
    <header>
        <nav>
            <div class="menu_toggle">
                <input type="checkbox">
                <div class="logo">
                    <a href="index.html"><img src="./img/logo.png"></a>
                </div>
                <ul class="nav">
                    <li><a href="course.html">課程總覽</a></li>
                    <li><a href="teacher.html">教師總覽</a></li>
                    <li>
                        <a href="index.html"><img src="./img/logo.png"></a>
                    </li>
                    <li><a href="mall.html">商城</a></li>
                    <li><a href="game.html">小遊戲</a></li>
                </ul>
                <div class="ham">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <ul class="nav-right">
                    <li><a href="member.html"><i class="fas fa-user-circle fa-lg"></i></a></li>
                    <li><a href="cart.html"><i class="fas fa-shopping-cart fa-lg"></i></a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main class="main">
        <div class="course_filter">
            <img class="img_bat" src="./img/course_cards/bat.png" alt="">
            <div class="filter_container">
                <div class="course_class">
                    <h3>依照屬性篩選</h3>
                    <div class="fliter_block">

                        <h4 class="courseType" id=" ">全部</h4>
                        <h4 class="courseType" id="攻擊型">攻擊型</h4>
                        <h4 class="courseType" id="防禦型">防禦型</h4>
                        <h4 class="courseType" id="輔助型">輔助型</h4>
                    </div>

                </div>


                <div class="course_price">
                    <h3>依照價位篩選</h3>
                    <div class="fliter_block">
                        <h4 class="coursePrice" id="5000">$5000以下</h4>
                        <h4 class="coursePrice" id="10000">$10000以下</h4>
                        <h4 class="coursePrice" id="20000">$20000以下</h4>
                    </div>
                </div>
            </div>
        </div>

        <div class="all_course_card app" id="course_block">

            <div class="card" v-for='classRow in classRows' ontouchstart="this.classList.toggle('hover');">
                <p class="course_title">{{classRow.courseName}}</p>
                <div class="center-content">
                    <div class="heart" @click="changeHeart" data-course="classRow.courseNo">
                        <!-- 用jquery each去比對從資料庫來的資料，有的話就loved -->
                        <div class="heart-inner" :id="classRow.courseNo" @click="addFavourite"></div>
                    </div>
                </div>
                <div class="container">
                    <div class="front">
                        <img :src=classRow.courseImg alt="">
                        <div class="inner">

                        </div>
                    </div>
                    <a :href="'singleCourse.php?courseNo='+classRow.courseNo" target="_parent" alt="">
                        <div class="back">
                            <img src="./img/course_cards/card_back.png" alt="">
                            <div class="inner">
                                <p class="course_price">${{classRow.coursePrice}}</p>
                                <p class="course_class">屬性：{{classRow.courTypeName}}</p>
                                <a href="./registration.html">
                                    <p class="registration"
                                        @click='classJump(classRow.courseName,classRow.coursePrice)'> 立即報名
                                    </p>
                            </div>
                        </div>
                    </a>
                </div>
            </div>


        </div>


        <div class="course_accessory">
            <p>你可能需要的道具</p>
            <div class="titleimg_block">
                <img class="white_title" src="./img/course_cards/title-white-line.png" alt="">
            </div>

            <div class="accessory_container">
                <div class="sliderboard">
                    <div class="single_accessory">
                        <a href="mall.html"> <img src="./img/course_cards/accessory/p1.png" alt="">
                        </a>
                    </div>
                    <div class="single_accessory">
                        <a href="mall.html"> <img src="./img/course_cards/accessory/p2.png" alt="">
                        </a>

                    </div>
                    <div class="single_accessory">
                        <a href="mall.html"> <img src="./img/course_cards/accessory/p3.png" alt="">
                        </a>

                    </div>
                    <div class="single_accessory">
                        <a href="mall.html"> <img src="./img/course_cards/accessory/p4.png" alt="">
                        </a>

                    </div>
                    <div class="single_accessory">
                        <a href="mall.html"> <img src="./img/course_cards/accessory/p5.png" alt="">
                        </a>
                    </div>
                    <div class="single_accessory">
                        <a href="mall.html"> <img src="./img/course_cards/accessory/p6.png" alt="">
                        </a>
                    </div>
                    <div class="single_accessory">
                        <a href="mall.html"> <img src="./img/course_cards/accessory/p7.png" alt="">
                        </a>
                    </div>
                    <div class="single_accessory">
                        <a href="mall.html"> <img src="./img/course_cards/accessory/p8.png" alt="">
                        </a>

                    </div>
                    <div class="single_accessory">
                        <a href="mall.html"> <img src="./img/course_cards/accessory/p9.png" alt="">
                        </a>

                    </div>
                    <div class="single_accessory">
                        <a href="mall.html"> <img src="./img/course_cards/accessory/p10.png" alt="">
                        </a>

                    </div>
                    <div class="single_accessory">
                        <a href="mall.html"> <img src="./img/course_cards/accessory/p11.png" alt="">
                        </a>

                    </div>
                    <div class="single_accessory">
                        <a href="mall.html"> <img src="./img/course_cards/accessory/p12.png" alt="">
                        </a>

                    </div>
                    <div class="single_accessory">
                        <a href="mall.html"> <img src="./img/course_cards/accessory/p13.png" alt="">
                        </a>

                    </div>
                </div>
            </div>

        </div>


    </main>

    <footer>
        <p>copyright©2020 CED101_G3 麻瓜特訓班.All Rights Reserved</p>
    </footer>


    <script src='https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.js'></script>

    <script>

        let storage = sessionStorage;
        let app = new Vue({
            el: '.app',
            data: {
                classRows: [],
                loved: false,
            },
            created() {

            },
            methods: {
                classJump(name, Price) {
                    storage['className'] = name;
                    storage['classPrice'] = Price;
                },
                changeHeart: function (e) {
                    e.target.parentNode.classList.toggle('loved');
                    // console.log(e.target);
                },
                addFavourite: function (e) {
                    let heartClass = e.target.parentNode.className;
                    // console.log(heartClass);
                    let courseNo = e.target.id;
                    if (heartClass == 'heart') {
                        // alert('已加入收藏');
                        $.ajax({
                            method: 'GET',
                            url: './php/course_addFavourite.php',
                            type: 'json',
                            data: `courseNo=${courseNo}`, //click後傳值到PHP
                            success: function (lovedCourse) {
                                console.log(lovedCourse); //把新增後資料回傳用變數接收
                            }
                        })

                    } else {
                        $.ajax({
                            method: 'GET',
                            url: './php/course_removeFavourite.php',
                            data: `courseNo=${courseNo}`,
                        })
                    }
                }
            },
        })

        window.addEventListener("load", function () {

            //取出課程
            function getCourse(courTypeName) {
                let xhr = new XMLHttpRequest();
                xhr.onload = function () {
                    app.classRows = JSON.parse(xhr.responseText);
                    console.log(app.classRows);
                }
                xhr.open("get", `./php/getCourse.php?courTypeName=${courTypeName}`, false);
                xhr.send(null);
                console.log(courTypeName);
            }
            getCourse('');

            //取出收藏課程
            function getlovedCourse() {
                $.ajax({
                    method: 'GET',
                    url: './php/getLovedCourse.php',
                    type: 'json',
                    success: function (lovedCourse_load) {
                        console.log(lovedCourse_load);
                    }
                })
            }
            getlovedCourse();

            //在課程類別按鈕上綁定click事件
            let courseTypeBtn = document.getElementsByClassName("courseType")
            for (let i = 0; i < courseTypeBtn.length; i++) {
                courseTypeBtn[i].addEventListener('click', function () {

                    let courTypeName = this.id; //攻擊型 防禦型 輔助型
                    console.log(courTypeName);
                    getCourse(courTypeName);
                })
            }

            //在課程類別按鈕上綁定click事件
            let priceBtn = document.getElementsByClassName("coursePrice")
            for (let i = 0; i < priceBtn.length; i++) {
                priceBtn[i].addEventListener('click', function () {
                    let coursePrice = this.id;
                    console.log(coursePrice);
                    getCourse(coursePrice);

                })
            }



            // // slick輪播
            // $('.sliderboard').slick({
            //     infinite: true,
            //     slidesToShow: 3,
            //     slidesToScroll: 3,
            //     autoplay: true,
            //     autoplaySpeed: 3000
            // });


            //蝙蝠浮動
            gsap.to('.img_bat', { y: 20, duration: 2, repeat: -1, yoyo: true });


        });

        //slick輪播
        $('.sliderboard').slick({
            infinite: true,
            slidesToShow: 3,
            slidesToScroll: 3,
            autoplay: true,
            autoplaySpeed: 3000
        });


        //蝙蝠浮動
        gsap.to('.img_bat', { y: 20, duration: 2, repeat: -1, yoyo: true });


    </script>

</body>

</html>